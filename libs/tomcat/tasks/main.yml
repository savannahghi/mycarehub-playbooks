---
- name: Create Tomcat installation dir
  ansible.builtin.file:
    group: "{{ tomcat_owning_group }}"
    mode: "ug=rwx,o=rx"
    owner: "{{ tomcat_owning_user }}"
    path: "{{ tomcat_installation_dir }}"
    state: directory 
  become: yes
  tags: ["tomcat"]

- name: Download Apache Tomcat
  ansible.builtin.get_url:
    dest: "{{ tomcat_temp_download_dir }}/apache_tomcat.tar.gz"
    force: yes
    timeout: 10
    url: "{{ tomcat_download_url }}" 
  become: yes
  tags: ["tomcat"]

- name: Unarchive and install Apache Tomcat
  ansible.builtin.unarchive:
    dest: "{{ tomcat_installation_dir }}"
    extra_opts:
      - --strip-components
      - 1
    group: "{{ tomcat_owning_group }}"
    keep_newer: yes
    owner: "{{ tomcat_owning_user }}"
    remote_src: yes
    src: "{{ tomcat_temp_download_dir }}/apache_tomcat.tar.gz"
  become: yes
  tags: ["tomcat"]
