---

- name: Test MySQL 5.6 Community Server installation and setup
  hosts: test_servers
  pre_tasks:
    - name: Create deploy user
      ansible.builtin.user: name={{ deploy_user }} groups=www-data,sudo state=present
      become: true
  post_tasks:
    - name: Deploy successful, remove lock_file
      ansible.builtin.file: path={{ lock_file_path }} state=absent
      become: true
  roles:
    - common
  strategy: free
  vars:
    deploy_user: deploy
    force_ignore_lock: "{{ force_ignore_lock }}"
    lock_file_path: /tmp/ansible-test-mysql56-deploy.lock

  tasks:
    - name: Install and set up MySQL 5.6 Community Server
      import_role:
        name: mysql56
      tags: ["test_mysql56"]
